<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>大阪駅中心の地図 - 半径1km円</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css" />
<style>
body, html {
	margin: 0;
	padding: 0;
	height: 100%;
	width: 100%;
	overflow: hidden;
}
#map {
	height: 100vh;
	width: 100vw;
}
.info-panel {
	display: none;		/* 非表示 */
	position: absolute;
	top: 10px;
	right: 10px;
	background: white;
	padding: 15px;
	border-radius: 8px;
	box-shadow: 0 2px 10px rgba(0,0,0,0.3);
	z-index: 1000;
	font-family: Arial, sans-serif;
	font-size: 14px;
	max-width: 200px;
}
.info-panel h3 {
	margin: 0 0 10px 0;
	color: #333;
	font-size: 16px;
}
.info-panel p {
	margin: 5px 0;
	color: #666;
}
.facility-label {
	background-color: yellow;
	color: red;
	padding: 2px 6px;
	border-radius: 3px;
	font-size: 12px;
	font-weight: bold;
	white-space: nowrap;
	box-shadow: 0 1px 3px rgba(0,0,0,0.3);
	border: 1px solid #ccc;
}
.facility-label {	/* マーカーラベル */
	display: table-cell;
	color: #f00;
	background-color: #ff4;
	opacity: 0.7;
	white-space: nowrap;
	font-size: 12px;
	font-weight: bold;
}
</style>
</head>
<body>
<div id="map"></div>
<div class="info-panel">
<h3>大阪駅</h3>
<p>半径1km圏内</p>
<p>座標: 34.7024, 135.4959</p>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
<script>
	const centerPoint = [34.7024, 135.4959];
	const map = L.map('map').setView(centerPoint, 15);
	const csvData = `大阪ステーションシティ, 34.703277, 135.496525
LUCUA 大阪, 34.702911, 135.495896
グランフロント大阪, 34.703866, 135.494921
阪急うめだ本店, 34.702677, 135.500057
阪神梅田本店, 34.699967, 135.497537
大丸梅田店, 34.701358, 135.496357
ヨドバシ梅田, 34.7041862, 135.4963787
ハービスPLAZA, 34.699279, 135.494272
ハービスPLAZA ENT, 34.6984946, 135.4927566
グラングリーン大阪北館, 34.707764, 135.495079
グラングリーン大阪南館, 34.706368, 135.495764
うめきたグリーンプレイス,34.705844,135.496525
KITTE大阪,34.702488,135.493863
ヒルトンプラザイースト, 34.700181, 135.4962
NU茶屋町, 34.707088, 135.49967
HEP FIVE, 34.703956, 135.500049
EST, 34.705027, 135.501006
ALBi大阪, 34.702061, 135.494639
阪急三番街, 34.704622, 135.500078
ホワイティうめだ, 34.701043, 135.498976
ディアモール大阪, 34.699894, 135.497654
エキマルシェ大阪, 34.701546, 135.495886
大阪駅前第一ビル, 34.699499, 135.495822
大阪駅前第二ビル, 34.699196, 135.496522
大阪駅前第三ビル, 34.698777, 135.497233
大阪駅前第四ビル, 34.698377, 135.497933
北新地, 34.6975, 135.4975
西天満, 34.7005, 135.5019
中崎町, 34.706746, 135.503432`;
	function parseCSV(csvText) {
		const lines = csvText.trim().split('\n');
		return lines.map(line => {
			const parts = line.split(',').map(part => part.trim());
			return {
				name: parts[0],
				lat: parseFloat(parts[1]),
				lng: parseFloat(parts[2])
			};
		});
	}
	L.tileLayer('https://mt1.google.com/vt/lyrs=r&x={x}&y={y}&z={z}', {
		attribution: '<a href="https://developers.google.com/maps/documentation" target="_blank">Google Map</a>'
	}).addTo(map);
	const marker = L.marker(centerPoint).addTo(map);
	marker.bindPopup('<b>大阪駅</b><br>JR大阪駅の中心地点').openPopup();
	const circle = L.circle(centerPoint, {
		color: '#FF6B6B',	// 境界線の色（赤系）
		weight: 3,		// 境界線の太さ
		opacity: 0.8,		// 境界線の透明度
		fillColor: '#FF6B6B',	// 塗りつぶし色
		fillOpacity: 0.2,	// 塗りつぶしの透明度
		radius: 1000		// 半径1km（1000メートル）
	}).addTo(map);
	circle.bindPopup('大阪駅から半径1kmの範囲');
	const facilities = parseCSV(csvData);
	facilities.forEach(facility => {
		const facilityMarker = L.marker([facility.lat, facility.lng], {
			icon: L.icon({
			//	iconUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon.png',
			//	shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png',
			//	iconSize: [25, 41],
			//	iconAnchor: [12, 41],
			//	popupAnchor: [1, -34],
			//	shadowSize: [41, 41]
				iconUrl: 'icon/red-dot.png',
				iconRetinaUrl: 'icon/red-dot.png',
				iconSize: [32, 32],
				iconAnchor: [14, 27],
				popupAnchor: [1, -22]
			})
		}).addTo(map);
		// 施設名ラベルを右下に表示
		const facilityLabel = L.marker([facility.lat, facility.lng], {
			icon: L.divIcon({
			//	className: 'facility-label',
			//	html: facility.name,
			//	iconSize: [100, 20],
			//	iconAnchor: [0, 0] // マーカーの右下に配置
				html: '<div class="facility-label">' + facility.name + '</div>',
				iconSize: [0,0]
			})
		}).addTo(map);
		// ポップアップ設定
		const distance = map.distance(centerPoint, [facility.lat, facility.lng]);
		facilityMarker.bindPopup(`
			<b>${facility.name}</b><br>
			大阪駅から ${Math.round(distance)}m<br>
			座標: ${facility.lat}, ${facility.lng}
		`);
	});
	// 地図の表示範囲を調整
	map.fitBounds(circle.getBounds(), {
		padding: [20, 20]  // 余白を追加
	});
	// クリックイベント
	map.on('click', function(e) {
		const clickedPoint = e.latlng;
		const distance = map.distance(centerPoint, clickedPoint);
		if (distance <= 1000) {
			L.popup()
				.setLatLng(clickedPoint)
				.setContent(`
					<b>大阪駅から ${Math.round(distance)}m</b><br>
					<span style="color: green;">1km圏内です</span>
				`)
				.openOn(map);
		} else {
			L.popup()
				.setLatLng(clickedPoint)
				.setContent(`
					<b>大阪駅から ${Math.round(distance)}m</b><br>
					<span style="color: red;">1km圏外です</span>
				`)
				.openOn(map);
		}
	});
</script>
</body>
</html>